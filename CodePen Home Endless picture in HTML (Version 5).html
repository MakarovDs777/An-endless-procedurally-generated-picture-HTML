<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Генератор изображений</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>
  <input type="number" id="xInput" placeholder="X координата">
  <input type="number" id="yInput" placeholder="Y координата">
  <input type="text" id="seedInput" placeholder="Сид">
  <button id="randomBtn">Случайные координаты</button>
  <button id="generateBtn">Сгенерировать изображение</button>
  <input type="number" id="speedInput" placeholder="Интервал перемещения (мс)" value="1000">
  <button id="moveBtn">Авто-перемещение</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const xInput = document.getElementById('xInput');
    const yInput = document.getElementById('yInput');
    const seedInput = document.getElementById('seedInput');
    const randomBtn = document.getElementById('randomBtn');
    const generateBtn = document.getElementById('generateBtn');
    const moveBtn = document.getElementById('moveBtn');
    const speedInput = document.getElementById('speedInput');

    let x = 0;
    let y = 0;
    let seed = 1; // Дефолтный сид
    let frameCount = 10; // Количество кадров
    let currentFrameIndex = 0;
    let moveInterval = null;
    let isMoving = false;

    function generateSequentialColors(seed) {
      const imageData = ctx.createImageData(canvas.width, canvas.height);
      const data = imageData.data;

      const totalPixels = canvas.width * canvas.height;

      Math.seedrandom(seed + currentFrameIndex); // Устанавливаем сид для каждого кадра

      for (let i = 0; i < totalPixels; i++) {
        let r = (i * 3) % 256;
        let g = (i * 3 + 1) % 256;
        let b = (i * 3 + 2) % 256;
        
        data[i * 4] = r;       // Red
        data[i * 4 + 1] = g;   // Green
        data[i * 4 + 2] = b;   // Blue
        data[i * 4 + 3] = 255; // Alpha
      }

      ctx.putImageData(imageData, 0, 0);
    }

    function updateInputs() {
      xInput.value = Math.round(x);
      yInput.value = Math.round(y);
      seedInput.value = seed;
    }

    function handleRandomCoordinates() {
      x = Math.floor(Math.random() * 100000);
      y = Math.floor(Math.random() * 100000);
      generateSequentialColors(seed); // Генерация изображения с новыми координатами
      updateInputs();
    }

    function toggleAutoMove() {
      if (isMoving) {
        clearInterval(moveInterval);
        isMoving = false;
        moveBtn.textContent = "Авто-перемещение"; // Изменить текст кнопки
      } else {
        const move = () => {
          x = Math.floor(Math.random() * 100000);
          y = Math.floor(Math.random() * 100000);
          generateSequentialColors(seed); // Генерация изображения при случайном перемещении
          updateInputs();
        };

        const interval = parseFloat(speedInput.value) || 1000;
        clearInterval(moveInterval);
        move(); // Переместиться сразу при старте
        moveInterval = setInterval(move, interval);
        isMoving = true;
        moveBtn.textContent = "Остановить перемещение"; // Изменить текст кнопки
      }
    }

    function handleInputChange() {
      x = parseInt(xInput.value) || 0;
      y = parseInt(yInput.value) || 0;
      seed = seedInput.value || 1;
      generateSequentialColors(seed); // Генерация изображения при изменении
      updateInputs();
    }

    generateBtn.addEventListener('click', () => {
      generateSequentialColors(seed); // Генерация изображения по текущему сиду
      currentFrameIndex++;
      if (currentFrameIndex >= frameCount) {
        currentFrameIndex = 0; // Сбросить индекс, чтобы повторять
      }
      updateInputs();
    });

    randomBtn.addEventListener('click', handleRandomCoordinates);
    moveBtn.addEventListener('click', toggleAutoMove);

    // Начальная генерация
    generateSequentialColors(seed);
    updateInputs();
  </script>
</body>
</html>
